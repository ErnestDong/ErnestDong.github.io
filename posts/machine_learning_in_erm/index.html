<!DOCTYPE html>
<html lang="">
<head>
  <link rel="preload" href="/lib/font-awesome/webfonts/fa-brands-400.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <link rel="preload" href="/lib/font-awesome/webfonts/fa-regular-400.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <link rel="preload" href="/lib/font-awesome/webfonts/fa-solid-900.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <link rel="preload" href="/lib/JetBrainsMono/web/woff2/JetBrainsMono-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <script type="text/javascript" src="/js/cactus.js"></script>
  <link rel="stylesheet" href="/css/style.css" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title> 机器学习在企业风险管理中的应用举例 | Ernest Dong</title>
  <link rel = 'canonical' href = 'https://ernestdong.github.io/posts/machine_learning_in_erm/'>
  <meta name="description" content="A Sisyphus Rolling Up Rock">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="robots" content="all,follow">
  <meta name="googlebot" content="index,follow,snippet,archive">
  <meta property="og:title" content="机器学习在企业风险管理中的应用举例" />
<meta property="og:description" content="前言 什么是学习？ 维基百科上说学习是获得新的理解、知识、行为、技能、价值观、态度和偏好的过程。在计算技术快速发展的今天，染机器去利用算法和算力" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://ernestdong.github.io/posts/machine_learning_in_erm/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-03-14T00:00:00+08:00" />
<meta property="article:modified_time" content="2022-03-14T00:00:00+08:00" />


  <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="机器学习在企业风险管理中的应用举例"/>
<meta name="twitter:description" content="前言 什么是学习？ 维基百科上说学习是获得新的理解、知识、行为、技能、价值观、态度和偏好的过程。在计算技术快速发展的今天，染机器去利用算法和算力"/>

  
  
  
  <link rel="stylesheet" href="https://ernestdong.github.io/css/styles.f7b0b81ffd948bc2b51bc47986281e591e9b39c46e6a18845e310537e786f77866b48fb756426e711bfa065a4ec7260ede6260c54bd2ed0827d693b01d7af483.css" integrity="sha512-97C4H/2Ui8K1G8R5higeWR6bOcRuahiEXjEFN&#43;eG93hmtI&#43;3VkJucRv6BlpOxyYO3mJgxUvS7Qgn1pOwHXr0gw=="> 

  
   <link rel="stylesheet" href="https://ernestdong.github.io/css/custom.css"> 
  
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  

  
<link rel="icon" type="image/png" href="https://ernestdong.github.io/images/favicon.ico" />

  
  
  
  
</head>

<body class="max-width mx-auto px3 ltr">
  <div class="content index py4">

  <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;" aria-label="Top of Page"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        
        <li><a href="/">Home</a></li>
        
        <li><a href="/notes">Notes</a></li>
        
        <li><a href="/posts">Posts</a></li>
        
        <li><a href="/tags">Tags</a></li>
        
        <li><a href="/readme/index.html">About</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li>
          <a class="icon" href=" https://ernestdong.github.io/notes/theses/" aria-label="Previous">
            <i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i>
          </a>
        </li>
        
        
        <li>
          <a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" aria-label="Top of Page">
            <i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i>
          </a>
        </li>
        <li>
          <a class="icon" href="#" aria-label="Share">
            <i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i>
          </a>
        </li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="toc">
      <nav id="TableOfContents">
  <ul>
    <li><a href="#前言">前言</a></li>
    <li><a href="#机器学习在企业风险管理中的应用">机器学习在企业风险管理中的应用</a></li>
    <li><a href="#机器学习预测信用评级">机器学习预测信用评级</a>
      <ul>
        <li><a href="#数据说明">数据说明</a></li>
        <li><a href="#线性回归与决策树">线性回归与决策树</a></li>
        <li><a href="#集成学习">集成学习</a></li>
        <li><a href="#支持向量机">支持向量机</a></li>
        <li><a href="#k-means">K means</a></li>
        <li><a href="#深度学习-神经网络">深度学习/神经网络</a></li>
        <li><a href="#对比">对比</a></li>
      </ul>
    </li>
    <li><a href="#reference">reference</a></li>
  </ul>
</nav>
    </div>
    <div id="share" style="display: none">
      
      <ul>
  
  
    
  
  
  <li>
    <a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fernestdong.github.io%2fposts%2fmachine_learning_in_erm%2f" aria-label="Facebook">
      <i class="fab fa-facebook " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://twitter.com/share?url=https%3a%2f%2fernestdong.github.io%2fposts%2fmachine_learning_in_erm%2f&text=%e6%9c%ba%e5%99%a8%e5%ad%a6%e4%b9%a0%e5%9c%a8%e4%bc%81%e4%b8%9a%e9%a3%8e%e9%99%a9%e7%ae%a1%e7%90%86%e4%b8%ad%e7%9a%84%e5%ba%94%e7%94%a8%e4%b8%be%e4%be%8b" aria-label="Twitter">
      <i class="fab fa-twitter " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fernestdong.github.io%2fposts%2fmachine_learning_in_erm%2f&title=%e6%9c%ba%e5%99%a8%e5%ad%a6%e4%b9%a0%e5%9c%a8%e4%bc%81%e4%b8%9a%e9%a3%8e%e9%99%a9%e7%ae%a1%e7%90%86%e4%b8%ad%e7%9a%84%e5%ba%94%e7%94%a8%e4%b8%be%e4%be%8b" aria-label="Linkedin">
      <i class="fab fa-linkedin " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2fernestdong.github.io%2fposts%2fmachine_learning_in_erm%2f&is_video=false&description=%e6%9c%ba%e5%99%a8%e5%ad%a6%e4%b9%a0%e5%9c%a8%e4%bc%81%e4%b8%9a%e9%a3%8e%e9%99%a9%e7%ae%a1%e7%90%86%e4%b8%ad%e7%9a%84%e5%ba%94%e7%94%a8%e4%b8%be%e4%be%8b" aria-label="Pinterest">
      <i class="fab fa-pinterest " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="mailto:?subject=%e6%9c%ba%e5%99%a8%e5%ad%a6%e4%b9%a0%e5%9c%a8%e4%bc%81%e4%b8%9a%e9%a3%8e%e9%99%a9%e7%ae%a1%e7%90%86%e4%b8%ad%e7%9a%84%e5%ba%94%e7%94%a8%e4%b8%be%e4%be%8b&body=Check out this article: https%3a%2f%2fernestdong.github.io%2fposts%2fmachine_learning_in_erm%2f" aria-label="Email">
      <i class="fas fa-envelope " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2fernestdong.github.io%2fposts%2fmachine_learning_in_erm%2f&title=%e6%9c%ba%e5%99%a8%e5%ad%a6%e4%b9%a0%e5%9c%a8%e4%bc%81%e4%b8%9a%e9%a3%8e%e9%99%a9%e7%ae%a1%e7%90%86%e4%b8%ad%e7%9a%84%e5%ba%94%e7%94%a8%e4%b8%be%e4%be%8b" aria-label="Pocket">
      <i class="fab fa-get-pocket " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2fernestdong.github.io%2fposts%2fmachine_learning_in_erm%2f&title=%e6%9c%ba%e5%99%a8%e5%ad%a6%e4%b9%a0%e5%9c%a8%e4%bc%81%e4%b8%9a%e9%a3%8e%e9%99%a9%e7%ae%a1%e7%90%86%e4%b8%ad%e7%9a%84%e5%ba%94%e7%94%a8%e4%b8%be%e4%be%8b" aria-label="reddit">
      <i class="fab fa-reddit " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.tumblr.com/share/link?url=https%3a%2f%2fernestdong.github.io%2fposts%2fmachine_learning_in_erm%2f&name=%e6%9c%ba%e5%99%a8%e5%ad%a6%e4%b9%a0%e5%9c%a8%e4%bc%81%e4%b8%9a%e9%a3%8e%e9%99%a9%e7%ae%a1%e7%90%86%e4%b8%ad%e7%9a%84%e5%ba%94%e7%94%a8%e4%b8%be%e4%be%8b&description=%e5%89%8d%e8%a8%80%20%e4%bb%80%e4%b9%88%e6%98%af%e5%ad%a6%e4%b9%a0%ef%bc%9f%20%e7%bb%b4%e5%9f%ba%e7%99%be%e7%a7%91%e4%b8%8a%e8%af%b4%e5%ad%a6%e4%b9%a0%e6%98%af%e8%8e%b7%e5%be%97%e6%96%b0%e7%9a%84%e7%90%86%e8%a7%a3%e3%80%81%e7%9f%a5%e8%af%86%e3%80%81%e8%a1%8c%e4%b8%ba%e3%80%81%e6%8a%80%e8%83%bd%e3%80%81%e4%bb%b7%e5%80%bc%e8%a7%82%e3%80%81%e6%80%81%e5%ba%a6%e5%92%8c%e5%81%8f%e5%a5%bd%e7%9a%84%e8%bf%87%e7%a8%8b%e3%80%82%e5%9c%a8%e8%ae%a1%e7%ae%97%e6%8a%80%e6%9c%af%e5%bf%ab%e9%80%9f%e5%8f%91%e5%b1%95%e7%9a%84%e4%bb%8a%e5%a4%a9%ef%bc%8c%e6%9f%93%e6%9c%ba%e5%99%a8%e5%8e%bb%e5%88%a9%e7%94%a8%e7%ae%97%e6%b3%95%e5%92%8c%e7%ae%97%e5%8a%9b" aria-label="Tumblr">
      <i class="fab fa-tumblr " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fernestdong.github.io%2fposts%2fmachine_learning_in_erm%2f&t=%e6%9c%ba%e5%99%a8%e5%ad%a6%e4%b9%a0%e5%9c%a8%e4%bc%81%e4%b8%9a%e9%a3%8e%e9%99%a9%e7%ae%a1%e7%90%86%e4%b8%ad%e7%9a%84%e5%ba%94%e7%94%a8%e4%b8%be%e4%be%8b" aria-label="Hacker News">
      <i class="fab fa-hacker-news " aria-hidden="true"></i>
    </a>
  </li>
</ul>

    </div>
  </span>
</div>


  <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
    <header>
      <h1 class="posttitle" itemprop="name headline">
        机器学习在企业风险管理中的应用举例
      </h1>
      <div class="meta">
        
        <div class="postdate">
          
          <time datetime="2022-03-14 00:00:00 &#43;0800 &#43;0800" itemprop="datePublished">2022-03-14</time>
          
        </div>
        
        
        <div class="article-read-time">
          <i class="far fa-clock"></i>
          
          25 minute read
        </div>
        
        
        
        <div class="article-tag">
            <i class="fas fa-tag"></i>
            
            
            <a class="tag-link" href="/tags/python" rel="tag">python</a>
            
        </div>
        
      </div>
    </header>

  
    
    <div class="content" itemprop="articleBody">
      <h2 id="前言">前言</h2>
<figure><img src="/images/xkcd/1838.png"/>
</figure>

<p>什么是学习？ <a href="https://zh.wikipedia.org/wiki/%E5%AD%A6%E4%B9%A0">维基百科</a>上说学习是获得新的理解、知识、行为、技能、价值观、态度和偏好的过程。在计算技术快速发展的今天，染机器去利用算法和算力去“学习”、推理、决策，就是机器学习。
机器学习按照学习的方式可以分为以下几种，但也不绝对，存在半监督学习和强化学习这种难以归类的方式，部分算法也可以横跨几种分类：</p>
<figure><img src="/ox-hugo/mathworks.svg"
         alt="Figure 1: 一些常见的机器学习算法"/><figcaption>
            <p><span class="figure-number">Figure 1: </span>一些常见的机器学习算法</p>
        </figcaption>
</figure>

<p>机器学习深究的话，需要学习很多数学和计算机。但是工业界将常用的机器学习算法封装地很好（pytorch, vc-git-region-history-font-lock-keywords, scikit-learn），几行代码就可以实现一个模型， <del>之后便是漫无止境地调参</del> 。</p>
<p>本文主要参考了Pedregosa et al. (<a href="#citeproc_bib_item_4">2011</a>)的文档，在编码过程中阅读文档是有帮助的。</p>
<h2 id="机器学习在企业风险管理中的应用">机器学习在企业风险管理中的应用</h2>
<p>Mai et al. (<a href="#citeproc_bib_item_3">2019</a>) 利用 CNN 预测企业破产，在处理文本数据时利用 word embedding 量化，AUC 曲线如图
<img src="https://ars.els-cdn.com/content/image/1-s2.0-S0377221718308774-gr5.jpg" alt=""></p>
<p>Golbayani, Florescu, and Chatterjee (<a href="#citeproc_bib_item_1">2020</a>)
使用决策树、随机森林、支持向量机和多层感知器应用于相同的数据集，预测公司未来评级。他们统计了机器学习在债券评级和公司信用评级方面的文章，很多认为 SVM 和神经网络是比较准确的。但是他们使用 Notches Distance 来对机器学习绩效来打分，认为基于决策树的两种方法更有效。</p>
<p>Kellner, Nagl, and Rösch (<a href="#citeproc_bib_item_2">2022</a>) 利用神经网络预测违约损失 Loss Given Default
将传统的分位数回归的回归元作为第一层，通过神经网络揭示其中的非线性关系，比如交叉项及其他非线性关系，神经网络最后一层是传统的分位数回归。利用 first order feature importance，量化输入变量的整体重要性。同时排除掉二阶的和交互的在分位数中接近于零。因此 QRNN 和分位数 QR 的分位数损失非常相似
通过允许分位数回归神经网络实现的分位数中的非线性和相互作用来扩展这种方法。这种方法大大增强了建模的灵活性。额外的灵活性在更好地分布拟合和超时样本方面带来了回报，分位数预测精度提高了 30%。同时更加 robust 。</p>
<p>当前机器学习最火热的两个应用方向是计算机视觉 CV 和自然语言处理 NLP ，亦有一些文献利用自然语言处理分析文本数据做研究。</p>
<h2 id="机器学习预测信用评级">机器学习预测信用评级</h2>
<h3 id="数据说明">数据说明</h3>
<p>数据来自 <a href="https://www.kaggle.com/datasets/agewerc/corporate-credit-rating">kaggle</a>
(下载好的在 <a href="/files/corporate_rating.csv">这里</a>)</p>
<p>A list of 2029 credit ratings issued by major agencies such as Standard and Poors to big US firms (traded on NYSE or Nasdaq) from 2010 to 2016.</p>
<p>There are 30 features for every company of which 25 are financial indicators. They can be divided in:</p>
<ol>
<li>
<p>Liquidity Measurement Ratios: currentRatio, quickRatio, cashRatio, daysOfSalesOutstanding</p>
</li>
<li>
<p>Profitability Indicator Ratios: grossProfitMargin, operatingProfitMargin, pretaxProfitMargin, netProfitMargin, effectiveTaxRate, returnOnAssets, returnOnEquity, returnOnCapitalEmployed</p>
</li>
<li>
<p>Debt Ratios: debtRatio, debtEquityRatio</p>
</li>
<li>
<p>Operating Performance Ratios:` assetTurnover</p>
</li>
<li>
<p>Cash Flow Indicator Ratios: operatingCashFlowPerShare, freeCashFlowPerShare, cashPerShare, operatingCashFlowSalesRatio, freeCashFlowOperatingCashFlowRatio</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#ff79c6">import</span> pandas <span style="color:#ff79c6">as</span> pd
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># df = pd.read_csv(&#34;./corporate_rating.csv&#34;, encoding=&#34;utf-8&#34;)</span>
</span></span><span style="display:flex;"><span>df <span style="color:#ff79c6">=</span> pd<span style="color:#ff79c6">.</span>read_csv(<span style="color:#f1fa8c">&#34;/Users/dcy/Code/erm/corporate_rating.csv&#34;</span>, encoding<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;utf-8&#34;</span>)
</span></span><span style="display:flex;"><span>df<span style="color:#ff79c6">.</span>info()
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>   &lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
</span></span><span style="display:flex;"><span>   RangeIndex: 2029 entries, 0 to 2028
</span></span><span style="display:flex;"><span>   Data columns (total 31 columns):
</span></span><span style="display:flex;"><span>    #   Column                              Non-Null Count  Dtype
</span></span><span style="display:flex;"><span>   ---  ------                              --------------  -----
</span></span><span style="display:flex;"><span>    0   Rating                              2029 non-null   object
</span></span><span style="display:flex;"><span>    1   Name                                2029 non-null   object
</span></span><span style="display:flex;"><span>    2   Symbol                              2029 non-null   object
</span></span><span style="display:flex;"><span>    3   Rating Agency Name                  2029 non-null   object
</span></span><span style="display:flex;"><span>    4   Date                                2029 non-null   object
</span></span><span style="display:flex;"><span>    5   Sector                              2029 non-null   object
</span></span><span style="display:flex;"><span>    6   currentRatio                        2029 non-null   float64
</span></span><span style="display:flex;"><span>    7   quickRatio                          2029 non-null   float64
</span></span><span style="display:flex;"><span>    8   cashRatio                           2029 non-null   float64
</span></span><span style="display:flex;"><span>    9   daysOfSalesOutstanding              2029 non-null   float64
</span></span><span style="display:flex;"><span>    10  netProfitMargin                     2029 non-null   float64
</span></span><span style="display:flex;"><span>    11  pretaxProfitMargin                  2029 non-null   float64
</span></span><span style="display:flex;"><span>    12  grossProfitMargin                   2029 non-null   float64
</span></span><span style="display:flex;"><span>    13  operatingProfitMargin               2029 non-null   float64
</span></span><span style="display:flex;"><span>    14  returnOnAssets                      2029 non-null   float64
</span></span><span style="display:flex;"><span>    15  returnOnCapitalEmployed             2029 non-null   float64
</span></span><span style="display:flex;"><span>    16  returnOnEquity                      2029 non-null   float64
</span></span><span style="display:flex;"><span>    17  assetTurnover                       2029 non-null   float64
</span></span><span style="display:flex;"><span>    18  fixedAssetTurnover                  2029 non-null   float64
</span></span><span style="display:flex;"><span>    19  debtEquityRatio                     2029 non-null   float64
</span></span><span style="display:flex;"><span>    20  debtRatio                           2029 non-null   float64
</span></span><span style="display:flex;"><span>    21  effectiveTaxRate                    2029 non-null   float64
</span></span><span style="display:flex;"><span>    22  freeCashFlowOperatingCashFlowRatio  2029 non-null   float64
</span></span><span style="display:flex;"><span>    23  freeCashFlowPerShare                2029 non-null   float64
</span></span><span style="display:flex;"><span>    24  cashPerShare                        2029 non-null   float64
</span></span><span style="display:flex;"><span>    25  companyEquityMultiplier             2029 non-null   float64
</span></span><span style="display:flex;"><span>    26  ebitPerRevenue                      2029 non-null   float64
</span></span><span style="display:flex;"><span>    27  enterpriseValueMultiple             2029 non-null   float64
</span></span><span style="display:flex;"><span>    28  operatingCashFlowPerShare           2029 non-null   float64
</span></span><span style="display:flex;"><span>    29  operatingCashFlowSalesRatio         2029 non-null   float64
</span></span><span style="display:flex;"><span>    30  payablesTurnover                    2029 non-null   float64
</span></span><span style="display:flex;"><span>   dtypes: float64(25), object(6)
</span></span><span style="display:flex;"><span>   memory usage: 491.5+ KB
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ol>
<p>评级分布如下图。我们可以看到评级 CC, C, D 的企业数量较少。三大评级公司所谓的“D”是违约“Default”，因此我们保留下来 D 级，而合并 <code>CCC</code> <code>CC</code> <code>C</code> 。一方面是由于 CCC 以下数量少，另一方面是由于大多数“评级下调加速到期”条款限定在了降至 CCC 的垃圾级。类似的，由于 AAA 企业数量很少都是非常优质的企业（ <del>不像目前国内评级新发债一半为 AAA</del> ），而 AA 和 A 数量都不小，我们仍然单独把他们拿出来。</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#ff79c6">import</span> matplotlib.pyplot <span style="color:#ff79c6">as</span> plt
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">import</span> seaborn <span style="color:#ff79c6">as</span> sns
</span></span><span style="display:flex;"><span>sns<span style="color:#ff79c6">.</span>set(style<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;white&#34;</span>, context<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;paper&#34;</span>, font<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;VictorMono Nerd Font Mono&#34;</span>)
</span></span><span style="display:flex;"><span>df[<span style="color:#f1fa8c">&#34;Rating&#34;</span>]<span style="color:#ff79c6">.</span>value_counts()<span style="color:#ff79c6">.</span>plot(kind<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;bar&#34;</span>)
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>&lt;AxesSubplot:&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><figure><img src="/ox-hugo/3d35918888125caf7bec2a135968b47e5e1dc2e2.png"/>
</figure>

<p>让我们处理一下数据</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#ff79c6">from</span> sklearn.model_selection <span style="color:#ff79c6">import</span> train_test_split
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">from</span> sklearn.metrics <span style="color:#ff79c6">import</span> f1_score, recall_score, precision_score
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Y <span style="color:#ff79c6">=</span> df[<span style="color:#f1fa8c">&#34;Rating&#34;</span>]
</span></span><span style="display:flex;"><span>Y <span style="color:#ff79c6">=</span> Y<span style="color:#ff79c6">.</span>replace({<span style="color:#f1fa8c">&#34;CCC&#34;</span>: <span style="color:#f1fa8c">&#34;C&#34;</span>, <span style="color:#f1fa8c">&#34;CC&#34;</span>: <span style="color:#f1fa8c">&#34;C&#34;</span>})
</span></span><span style="display:flex;"><span>df[<span style="color:#f1fa8c">&#34;Date&#34;</span>] <span style="color:#ff79c6">=</span> df[<span style="color:#f1fa8c">&#34;Date&#34;</span>]<span style="color:#ff79c6">.</span>apply(<span style="color:#ff79c6">lambda</span> x: x<span style="color:#ff79c6">.</span>split(<span style="color:#f1fa8c">&#34;/&#34;</span>)[<span style="color:#ff79c6">-</span><span style="color:#bd93f9">1</span>])
</span></span><span style="display:flex;"><span>dummies <span style="color:#ff79c6">=</span> [<span style="color:#f1fa8c">&#34;Rating Agency Name&#34;</span>, <span style="color:#f1fa8c">&#34;Sector&#34;</span>, <span style="color:#f1fa8c">&#34;Date&#34;</span>]
</span></span><span style="display:flex;"><span>X <span style="color:#ff79c6">=</span> df[[i <span style="color:#ff79c6">for</span> i <span style="color:#ff79c6">in</span> df<span style="color:#ff79c6">.</span>columns <span style="color:#ff79c6">if</span> df[i]<span style="color:#ff79c6">.</span>dtype <span style="color:#ff79c6">!=</span> <span style="color:#f1fa8c">&#34;object&#34;</span>]]
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">for</span> dummy <span style="color:#ff79c6">in</span> dummies:
</span></span><span style="display:flex;"><span>    X <span style="color:#ff79c6">=</span> pd<span style="color:#ff79c6">.</span>concat([X, pd<span style="color:#ff79c6">.</span>get_dummies(df[dummy], drop_first<span style="color:#ff79c6">=</span><span style="color:#ff79c6">True</span>, prefix<span style="color:#ff79c6">=</span>dummy)], axis<span style="color:#ff79c6">=</span><span style="color:#bd93f9">1</span>)
</span></span><span style="display:flex;"><span>Xtrain, Xtest, Ytrain, Ytest <span style="color:#ff79c6">=</span> train_test_split(X, Y, test_size<span style="color:#ff79c6">=</span><span style="color:#bd93f9">0.2</span>, random_state<span style="color:#ff79c6">=</span><span style="color:#bd93f9">42</span>)
</span></span><span style="display:flex;"><span>result <span style="color:#ff79c6">=</span> {}
</span></span><span style="display:flex;"><span>X<span style="color:#ff79c6">.</span>columns
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>Index([&#39;currentRatio&#39;, &#39;quickRatio&#39;, &#39;cashRatio&#39;, &#39;daysOfSalesOutstanding&#39;,
</span></span><span style="display:flex;"><span>       &#39;netProfitMargin&#39;, &#39;pretaxProfitMargin&#39;, &#39;grossProfitMargin&#39;,
</span></span><span style="display:flex;"><span>       &#39;operatingProfitMargin&#39;, &#39;returnOnAssets&#39;, &#39;returnOnCapitalEmployed&#39;,
</span></span><span style="display:flex;"><span>       &#39;returnOnEquity&#39;, &#39;assetTurnover&#39;, &#39;fixedAssetTurnover&#39;,
</span></span><span style="display:flex;"><span>       &#39;debtEquityRatio&#39;, &#39;debtRatio&#39;, &#39;effectiveTaxRate&#39;,
</span></span><span style="display:flex;"><span>       &#39;freeCashFlowOperatingCashFlowRatio&#39;, &#39;freeCashFlowPerShare&#39;,
</span></span><span style="display:flex;"><span>       &#39;cashPerShare&#39;, &#39;companyEquityMultiplier&#39;, &#39;ebitPerRevenue&#39;,
</span></span><span style="display:flex;"><span>       &#39;enterpriseValueMultiple&#39;, &#39;operatingCashFlowPerShare&#39;,
</span></span><span style="display:flex;"><span>       &#39;operatingCashFlowSalesRatio&#39;, &#39;payablesTurnover&#39;,
</span></span><span style="display:flex;"><span>       &#39;Rating Agency Name_Egan-Jones Ratings Company&#39;,
</span></span><span style="display:flex;"><span>       &#39;Rating Agency Name_Fitch Ratings&#39;,
</span></span><span style="display:flex;"><span>       &#39;Rating Agency Name_Moody&#39;s Investors Service&#39;,
</span></span><span style="display:flex;"><span>       &#39;Rating Agency Name_Standard &amp; Poor&#39;s Ratings Services&#39;,
</span></span><span style="display:flex;"><span>       &#39;Sector_Capital Goods&#39;, &#39;Sector_Consumer Durables&#39;,
</span></span><span style="display:flex;"><span>       &#39;Sector_Consumer Non-Durables&#39;, &#39;Sector_Consumer Services&#39;,
</span></span><span style="display:flex;"><span>       &#39;Sector_Energy&#39;, &#39;Sector_Finance&#39;, &#39;Sector_Health Care&#39;,
</span></span><span style="display:flex;"><span>       &#39;Sector_Miscellaneous&#39;, &#39;Sector_Public Utilities&#39;, &#39;Sector_Technology&#39;,
</span></span><span style="display:flex;"><span>       &#39;Sector_Transportation&#39;, &#39;Date_2009&#39;, &#39;Date_2010&#39;, &#39;Date_2011&#39;,
</span></span><span style="display:flex;"><span>       &#39;Date_2012&#39;, &#39;Date_2013&#39;, &#39;Date_2014&#39;, &#39;Date_2015&#39;, &#39;Date_2016&#39;],
</span></span><span style="display:flex;"><span>      dtype=&#39;object&#39;)
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>get_score</code> 中定义了三重维度来度量预测的准确性，如下表。precision 是 \(tp / (tp + fp)\) ，即预测阳性中真实为正的概率；recall 是 \(tp / (tp + fn)\) ，即样本中的正例有多少被预测正确了；而 f1 则是二者的调和平均</p>
<table>
<thead>
<tr>
<th></th>
<th>True</th>
<th>False</th>
</tr>
</thead>
<tbody>
<tr>
<td>Positive</td>
<td>TP</td>
<td>FP</td>
</tr>
<tr>
<td>Negative</td>
<td>TN</td>
<td>FN</td>
</tr>
</tbody>
</table>
<p>鉴于评级有七个，完完全全的准确率可能没有那么高，我们做一个随机的测试，作为基准。</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#ff79c6">from</span> scipy.stats <span style="color:#ff79c6">import</span> pearsonr
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">def</span> <span style="color:#50fa7b">get_score</span>(Xtest, Ytrue, model):
</span></span><span style="display:flex;"><span>    Ypred <span style="color:#ff79c6">=</span> model(Xtest)
</span></span><span style="display:flex;"><span>    average <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;weighted&#34;</span>
</span></span><span style="display:flex;"><span>    rating_map <span style="color:#ff79c6">=</span> {i: <span style="color:#8be9fd;font-style:italic">ord</span>(i[<span style="color:#bd93f9">0</span>]) <span style="color:#ff79c6">*</span> <span style="color:#bd93f9">100</span> <span style="color:#ff79c6">-</span> <span style="color:#8be9fd;font-style:italic">len</span>(i) <span style="color:#ff79c6">for</span> i <span style="color:#ff79c6">in</span> Y<span style="color:#ff79c6">.</span>unique()}
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">return</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;precision&#34;</span>: precision_score(Ytrue, Ypred, average<span style="color:#ff79c6">=</span>average, zero_division<span style="color:#ff79c6">=</span><span style="color:#bd93f9">0</span>),
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;recall&#34;</span>: recall_score(Ytrue, Ypred, average<span style="color:#ff79c6">=</span>average),
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;f1&#34;</span>: f1_score(Ytrue, Ypred, average<span style="color:#ff79c6">=</span>average),
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;\(R^2\)&#34;</span>: pearsonr([rating_map[i] <span style="color:#ff79c6">for</span> i <span style="color:#ff79c6">in</span> Ypred], [rating_map[i] <span style="color:#ff79c6">for</span> i <span style="color:#ff79c6">in</span> Ytest])[<span style="color:#bd93f9">0</span>]
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">import</span> random
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ratings <span style="color:#ff79c6">=</span> Y<span style="color:#ff79c6">.</span>unique()
</span></span><span style="display:flex;"><span>tmp <span style="color:#ff79c6">=</span> {}
</span></span><span style="display:flex;"><span>monte_num <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">100</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">for</span> i <span style="color:#ff79c6">in</span> <span style="color:#8be9fd;font-style:italic">range</span>(<span style="color:#bd93f9">100</span>):
</span></span><span style="display:flex;"><span>    Ypredict <span style="color:#ff79c6">=</span> Xtest<span style="color:#ff79c6">.</span>index<span style="color:#ff79c6">.</span>map(<span style="color:#ff79c6">lambda</span> x: random<span style="color:#ff79c6">.</span>choice(ratings))
</span></span><span style="display:flex;"><span>    monte <span style="color:#ff79c6">=</span> get_score(Xtest, Ytest, <span style="color:#ff79c6">lambda</span> _: Ypredict)
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">for</span> j <span style="color:#ff79c6">in</span> monte:
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">if</span> j <span style="color:#ff79c6">not</span> <span style="color:#ff79c6">in</span> tmp:
</span></span><span style="display:flex;"><span>            tmp[j] <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">0</span>
</span></span><span style="display:flex;"><span>        tmp[j] <span style="color:#ff79c6">+=</span> monte[j]
</span></span><span style="display:flex;"><span>result[<span style="color:#f1fa8c">&#34;random&#34;</span>] <span style="color:#ff79c6">=</span> {i: tmp[i] <span style="color:#ff79c6">/</span> <span style="color:#bd93f9">100</span> <span style="color:#ff79c6">for</span> i <span style="color:#ff79c6">in</span> tmp}
</span></span><span style="display:flex;"><span>result[<span style="color:#f1fa8c">&#34;random&#34;</span>]
</span></span></code></pre></td></tr></table>
</div>
</div><table>
<thead>
<tr>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>precision</td>
<td>:</td>
<td>0.2304826769736618</td>
<td>recall</td>
<td>:</td>
<td>0.12556650246305426</td>
<td>f1</td>
<td>:</td>
<td>0.15328435719093184</td>
<td>\(R^2\)</td>
<td>:</td>
<td>0.009731603250374804</td>
</tr>
</tbody>
</table>
<h3 id="线性回归与决策树">线性回归与决策树</h3>
<p>我们先看一些简单直接的例子。</p>
<p>按照维基百科的定义，我们在计量经济学中学习的 OLS/GLS/Logit 模型也是通过机器来学习拟合样本的分布，也是一种机器学习。统计学中的 lasso/ridge 等回归方式也在模型泛化中有许多应用。</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#ff79c6">from</span> sklearn.linear_model <span style="color:#ff79c6">import</span> LogisticRegression
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>logit <span style="color:#ff79c6">=</span> LogisticRegression(multi_class<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;multinomial&#34;</span>, solver<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;saga&#34;</span>)
</span></span><span style="display:flex;"><span>logit<span style="color:#ff79c6">.</span>fit(Xtrain, Ytrain)
</span></span><span style="display:flex;"><span>result[<span style="color:#f1fa8c">&#34;logit&#34;</span>] <span style="color:#ff79c6">=</span> get_score(Xtest, Ytest, logit<span style="color:#ff79c6">.</span>predict)
</span></span><span style="display:flex;"><span>result[<span style="color:#f1fa8c">&#34;logit&#34;</span>]
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>/Users/dcy/Code/erm/.venv/lib/python3.10/site-packages/sklearn/linear_model/_sag.py:352: ConvergenceWarning: The max_iter was reached which means the coef_ did not converge
</span></span><span style="display:flex;"><span>  warnings.warn(
</span></span></code></pre></td></tr></table>
</div>
</div><table>
<thead>
<tr>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>precision</td>
<td>:</td>
<td>0.1967590907374747</td>
<td>recall</td>
<td>:</td>
<td>0.2536945812807882</td>
<td>f1</td>
<td>:</td>
<td>0.16160916563141273</td>
<td>\(R^2\)</td>
<td>:</td>
<td>-0.0162496069249068</td>
</tr>
</tbody>
</table>
<p>决策树也在日常生活中有应用，车险定价或者我们日常的决策都可以抽象成决策树。
他的思想是，一个数据集有多个特征，每个节点按照某个特征是否满足一定的条件分叉，形成一棵二叉树。
该节点选取特征分叉的决策依据是最大化“信息增益”，即分叉前后数据更“有序”，且更有序的程度最大，常见指标的有2信息熵/基尼系数等。
这棵树为了避免过拟合，我们会对决策树“剪枝”，增加一些分支条件的限制，可以看<a href="https://scikit-learn.org/stable/modules/generated/sklearn.tree.DecisionTreeClassifier.html">这里</a>。</p>
<p>决策树好处是计算量简单，可解释性强，比较适合处理有缺失属性值的样本，能够处理不相关的特征；但是容易过拟合。</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#ff79c6">from</span> sklearn.tree <span style="color:#ff79c6">import</span> DecisionTreeClassifier
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>dt <span style="color:#ff79c6">=</span> DecisionTreeClassifier(max_depth<span style="color:#ff79c6">=</span><span style="color:#bd93f9">3</span>)
</span></span><span style="display:flex;"><span>dt<span style="color:#ff79c6">.</span>fit(Xtrain, Ytrain)
</span></span><span style="display:flex;"><span>result[<span style="color:#f1fa8c">&#34;decision tree&#34;</span>] <span style="color:#ff79c6">=</span> get_score(Xtest, Ytest, dt<span style="color:#ff79c6">.</span>predict)
</span></span><span style="display:flex;"><span>result[<span style="color:#f1fa8c">&#34;decision tree&#34;</span>]
</span></span></code></pre></td></tr></table>
</div>
</div><table>
<thead>
<tr>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>precision</td>
<td>:</td>
<td>0.36776900542565055</td>
<td>recall</td>
<td>:</td>
<td>0.4064039408866995</td>
<td>f1</td>
<td>:</td>
<td>0.3624046923337102</td>
<td>\(R^2\)</td>
<td>:</td>
<td>0.4866754450444671</td>
</tr>
</tbody>
</table>
<h3 id="集成学习">集成学习</h3>
<p>ensemble learning 是单个模型并不能很完美的解决某个分类或者回归问题（弱监督模型，在某些方面表现较好）的时候，那么就训练出多个弱监督模型，每个模型可能是相同的也可以是不同的，然后预测的时候将数据分别输入每个模型，最后将每个模型的输出综合起来作为该未知数据的输出即便某一个弱分类器得到了错误的预测，其他的弱分类器也可以将错误纠正回来。简而言之，采样-学习-组合。</p>
<p>如何训练和输出呢？</p>
<h4 id="bagging">bagging</h4>
<p>Bagging是bootstrap aggregating的简写。在 bagging 方法中，从整体数据集中采取有放回抽样得到N个数据集，在每个数据集上学习出一个模型。</p>
<p>随机森林就是采用了 bagging 的方式训练了许多棵决策树，是为“森林”。在输出时，每一棵树都将其结果“投票”，哪个类别多，输入样本就属于哪个类别。</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#ff79c6">from</span> sklearn.ensemble <span style="color:#ff79c6">import</span> RandomForestClassifier
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>rf <span style="color:#ff79c6">=</span> RandomForestClassifier(n_estimators<span style="color:#ff79c6">=</span><span style="color:#bd93f9">100</span>, max_depth<span style="color:#ff79c6">=</span><span style="color:#bd93f9">4</span>)
</span></span><span style="display:flex;"><span>rf<span style="color:#ff79c6">.</span>fit(Xtrain, Ytrain)
</span></span><span style="display:flex;"><span>result[<span style="color:#f1fa8c">&#34;random forest&#34;</span>] <span style="color:#ff79c6">=</span> get_score(Xtest, Ytest, rf<span style="color:#ff79c6">.</span>predict)
</span></span><span style="display:flex;"><span>result[<span style="color:#f1fa8c">&#34;random forest&#34;</span>]
</span></span></code></pre></td></tr></table>
</div>
</div><table>
<thead>
<tr>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>precision</td>
<td>:</td>
<td>0.3738310963554344</td>
<td>recall</td>
<td>:</td>
<td>0.4088669950738916</td>
<td>f1</td>
<td>:</td>
<td>0.3552598043693886</td>
<td>\(R^2\)</td>
<td>:</td>
<td>0.31522252981531806</td>
</tr>
</tbody>
</table>
<p>Bagging主要关注降低方差，因此它在不剪枝的决策树、神经网络等学习器上效用更为明显，不容易过拟合。</p>
<figure><img src="https://tfugcs.andfun.cn/original/2X/7/74f5a02b7692010da60a746d5469471c68b2ff3c.gif"
         alt="Figure 2: random forest"/><figcaption>
            <p><span class="figure-number">Figure 2: </span>random forest</p>
        </figcaption>
</figure>

<h4 id="boosting">boosting</h4>
<p><a href="#bagging">bagging</a> 的训练是平行的，boosting 则是迭代地训练一系列的分类器，每个分类器采用的样本分布都和上一轮的学习结果有关，直观比方是每个树都去学习上一个树没有学习好的地方，代表算法有AdaBoost（Adaptive boosting）算法，以及 XGBoost 算法。
调参时可以树的深度很少就能达到很高的精度。</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#ff79c6">from</span> sklearn.ensemble <span style="color:#ff79c6">import</span> GradientBoostingClassifier
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>gb <span style="color:#ff79c6">=</span> GradientBoostingClassifier()
</span></span><span style="display:flex;"><span>gb<span style="color:#ff79c6">.</span>fit(Xtrain, Ytrain)
</span></span><span style="display:flex;"><span>result[<span style="color:#f1fa8c">&#34;gradient boosting&#34;</span>] <span style="color:#ff79c6">=</span> get_score(Xtest, Ytest, gb<span style="color:#ff79c6">.</span>predict)
</span></span><span style="display:flex;"><span>result[<span style="color:#f1fa8c">&#34;gradient boosting&#34;</span>]
</span></span></code></pre></td></tr></table>
</div>
</div><table>
<thead>
<tr>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>precision</td>
<td>:</td>
<td>0.5120890067926741</td>
<td>recall</td>
<td>:</td>
<td>0.5172413793103449</td>
<td>f1</td>
<td>:</td>
<td>0.5021587259150085</td>
<td>\(R^2\)</td>
<td>:</td>
<td>0.5266537294262117</td>
</tr>
</tbody>
</table>
<h3 id="支持向量机">支持向量机</h3>
<p>Support Vector Machine, SVM 是一种二分类器，其思想是样本分布在空间中，找到一个可以划分开样本点、并且间隔最大的的（超）平面。直观上间隔最大是为了让模型更稳健。</p>
<p><a id="figure--SVM 图示"></a></p>
<figure><img src="https://pic2.zhimg.com/80/v2-f9e1e7fd08460a5fab044c71ed8b0bb1_1440w.jpg"
         alt="Figure 3: SVM 图示"/><figcaption>
            <p><span class="figure-number">Figure 3: </span>SVM 图示</p>
        </figcaption>
</figure>

<p>最简单的线性的硬间隔可分的如图 [3](#figure&ndash;SVM 图示) 所示，当然这是比较理想的情况。当样本分布更复杂的时候，我们会选择软间隔，即将之前的硬间隔最大化条件放宽一点，允许部分点出错，在优化函数中加入惩罚项。</p>
<p>如果还是不可以，我们会运用核函数来推导到非线形的情况，简单说就是将低维的样本点映射到高维空间，使样本线性可分。例如内积平方的核函数，\(K(v_1,V_2)=(x_1x_2+y_1y_2)^2\)，可以看作是三维空间中 \((x_i^2,\sqrt{2}x_iy_i,y_i^2)\) 两个点之间的距离</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#ff79c6">from</span> sklearn.svm <span style="color:#ff79c6">import</span> SVC
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>svm <span style="color:#ff79c6">=</span> SVC(kernel<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;rbf&#34;</span>, gamma<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;auto&#34;</span>)
</span></span><span style="display:flex;"><span>svm<span style="color:#ff79c6">.</span>fit(Xtrain, Ytrain)
</span></span><span style="display:flex;"><span>result[<span style="color:#f1fa8c">&#34;svm&#34;</span>] <span style="color:#ff79c6">=</span> get_score(Xtest, Ytest, svm<span style="color:#ff79c6">.</span>predict)
</span></span><span style="display:flex;"><span>result[<span style="color:#f1fa8c">&#34;svm&#34;</span>]
</span></span></code></pre></td></tr></table>
</div>
</div><table>
<thead>
<tr>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>precision</td>
<td>:</td>
<td>0.3871822535819534</td>
<td>recall</td>
<td>:</td>
<td>0.39408866995073893</td>
<td>f1</td>
<td>:</td>
<td>0.3310900991255093</td>
<td>\(R^2\)</td>
<td>:</td>
<td>0.3347635170409561</td>
</tr>
</tbody>
</table>
<h3 id="k-means">K means</h3>
<blockquote>
<p>有四个牧师去郊区布道，一开始牧师们随意选了几个布道点，并且把这几个布道点的情况公告给了郊区所有的村民，于是每个村民到离自己家最近的布道点去听课。</p>
<p>听课之后，大家觉得距离太远了，于是每个牧师统计了一下自己的课上所有的村民的地址，搬到了所有地址的中心地带，并且在海报上更新了自己的布道点的位置。</p>
<p>牧师每一次移动不可能离所有人都更近，有的人发现A牧师移动以后自己还不如去B牧师处听课更近，于是每个村民又去了离自己最近的布道点……</p>
<p>就这样，牧师每个礼拜更新自己的位置，村民根据自己的情况选择布道点，最终稳定了下来。</p>
</blockquote>
<p>之前提到的算法都需要对数据进行一定的标注，标好某些数据属于某个分类，也就是常说的“监督学习”。K-means 是一种无监督学习，我们不需要声明训练中的哪些数据是哪个分类。</p>
<p>K-means 的方法是，选择初始化的 k 个样本作为初始聚类中心 \(a_i\)  ，针对数据集中每个样本 \(x_i\)
计算它到 k 个聚类中心的距离，并将其分到距离最小的聚类中心所对应的类中；重新计算每个类别的质心作为聚类中心 \(a_i\) ，再重复上面的过程，直至聚类中心“稳定”下来。</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#ff79c6">from</span> sklearn.cluster <span style="color:#ff79c6">import</span> KMeans
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">import</span> numpy <span style="color:#ff79c6">as</span> np
</span></span><span style="display:flex;"><span>X <span style="color:#ff79c6">=</span> np<span style="color:#ff79c6">.</span>array([[<span style="color:#bd93f9">1</span>, <span style="color:#bd93f9">2</span>], [<span style="color:#bd93f9">1</span>, <span style="color:#bd93f9">4</span>], [<span style="color:#bd93f9">1</span>, <span style="color:#bd93f9">0</span>],
</span></span><span style="display:flex;"><span>              [<span style="color:#bd93f9">10</span>, <span style="color:#bd93f9">2</span>], [<span style="color:#bd93f9">10</span>, <span style="color:#bd93f9">4</span>], [<span style="color:#bd93f9">10</span>, <span style="color:#bd93f9">0</span>]])
</span></span><span style="display:flex;"><span>kmeans <span style="color:#ff79c6">=</span> KMeans(n_clusters<span style="color:#ff79c6">=</span><span style="color:#bd93f9">2</span>, random_state<span style="color:#ff79c6">=</span><span style="color:#bd93f9">0</span>)<span style="color:#ff79c6">.</span>fit(X)
</span></span><span style="display:flex;"><span>kmeans<span style="color:#ff79c6">.</span>predict([[<span style="color:#bd93f9">0</span>, <span style="color:#bd93f9">0</span>], [<span style="color:#bd93f9">12</span>, <span style="color:#bd93f9">3</span>]])
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="深度学习-神经网络">深度学习/神经网络</h3>
<p>深度学习以神经网络为基础。神经网络是一种模仿生物神经系统结构和功能的数学模型，对函数进行估计和近似。</p>
<h4 id="bp-神经网络">BP 神经网络</h4>
<p>是深度学习的入门算法，所谓 BP 是误差反向传播 Backpropagation，刺激正向传播后通过最小化误差反向传播更新权值（最小化的方式是“梯度下降”）。它的信息处理能力来源于简单非线性函数的多次复合。</p>
<p>样本还是太少，训练结果不佳。</p>
<!--list-separator-->
<ul>
<li>
<p>梯度下降与反向传播</p>
<p>我们用最小二乘法来理解“梯度下降”和“反向传播”</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#ff79c6">import</span> torch
</span></span><span style="display:flex;"><span>x <span style="color:#ff79c6">=</span> torch<span style="color:#ff79c6">.</span>rand([<span style="color:#bd93f9">500</span>,<span style="color:#bd93f9">1</span>]) <span style="color:#6272a4"># X 是一个 tensor ，可以把他想象成 500x1 的向量</span>
</span></span><span style="display:flex;"><span>y_true <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">3</span><span style="color:#ff79c6">*</span>x<span style="color:#ff79c6">+</span><span style="color:#bd93f9">8</span>
</span></span><span style="display:flex;"><span>learning_rate <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">0.05</span> <span style="color:#6272a4"># learning rate 是每次梯度下降的“步长”</span>
</span></span><span style="display:flex;"><span>w <span style="color:#ff79c6">=</span> torch<span style="color:#ff79c6">.</span>rand([<span style="color:#bd93f9">1</span>,<span style="color:#bd93f9">1</span>], requires_grad<span style="color:#ff79c6">=</span><span style="color:#ff79c6">True</span>) <span style="color:#6272a4"># w 和 b 我们要 pytorch 自动求导</span>
</span></span><span style="display:flex;"><span>b <span style="color:#ff79c6">=</span> torch<span style="color:#ff79c6">.</span>tensor(<span style="color:#bd93f9">0</span>, requires_grad<span style="color:#ff79c6">=</span><span style="color:#ff79c6">True</span>, dtype<span style="color:#ff79c6">=</span>torch<span style="color:#ff79c6">.</span>float32)
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">for</span> i <span style="color:#ff79c6">in</span> <span style="color:#8be9fd;font-style:italic">range</span>(<span style="color:#bd93f9">500</span>):
</span></span><span style="display:flex;"><span>    y_pred <span style="color:#ff79c6">=</span> torch<span style="color:#ff79c6">.</span>matmul(x,w)<span style="color:#ff79c6">+</span>b <span style="color:#6272a4"># 预测是多少</span>
</span></span><span style="display:flex;"><span>    loss <span style="color:#ff79c6">=</span> (y_true<span style="color:#ff79c6">-</span>y_pred)<span style="color:#ff79c6">.</span>pow(<span style="color:#bd93f9">2</span>)<span style="color:#ff79c6">.</span>mean() <span style="color:#6272a4"># 损失</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">if</span> w<span style="color:#ff79c6">.</span>grad <span style="color:#ff79c6">is</span> <span style="color:#ff79c6">not</span> <span style="color:#ff79c6">None</span>: <span style="color:#6272a4"># 把上一次的梯度清零</span>
</span></span><span style="display:flex;"><span>        w<span style="color:#ff79c6">.</span>grad<span style="color:#ff79c6">.</span>data<span style="color:#ff79c6">.</span>zero_()
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">if</span> b<span style="color:#ff79c6">.</span>grad <span style="color:#ff79c6">is</span> <span style="color:#ff79c6">not</span> <span style="color:#ff79c6">None</span>:
</span></span><span style="display:flex;"><span>        b<span style="color:#ff79c6">.</span>grad<span style="color:#ff79c6">.</span>data<span style="color:#ff79c6">.</span>zero_()
</span></span><span style="display:flex;"><span>    loss<span style="color:#ff79c6">.</span>backward() <span style="color:#6272a4"># 误差反向传播，得到 w 和 b 的梯度</span>
</span></span><span style="display:flex;"><span>    w<span style="color:#ff79c6">.</span>data <span style="color:#ff79c6">=</span> w<span style="color:#ff79c6">.</span>data <span style="color:#ff79c6">-</span> w<span style="color:#ff79c6">.</span>grad<span style="color:#ff79c6">*</span>learning_rate <span style="color:#6272a4"># 梯度下降找到新的 w 和 b</span>
</span></span><span style="display:flex;"><span>    b<span style="color:#ff79c6">.</span>data <span style="color:#ff79c6">=</span> b<span style="color:#ff79c6">.</span>data <span style="color:#ff79c6">-</span> b<span style="color:#ff79c6">.</span>grad<span style="color:#ff79c6">*</span>learning_rate
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">if</span> i <span style="color:#ff79c6">%</span> <span style="color:#bd93f9">50</span> <span style="color:#ff79c6">==</span> <span style="color:#bd93f9">0</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#8be9fd;font-style:italic">print</span>(w<span style="color:#ff79c6">.</span>item(), b<span style="color:#ff79c6">.</span>item(), loss<span style="color:#ff79c6">.</span>item())
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>1.2529112100601196 0.908143937587738 82.87687683105469
</span></span><span style="display:flex;"><span>4.105671405792236 7.4110026359558105 0.10492698103189468
</span></span><span style="display:flex;"><span>3.797273635864258 7.582289695739746 0.054102130234241486
</span></span><span style="display:flex;"><span>3.5728304386138916 7.699889183044434 0.02792842872440815
</span></span><span style="display:flex;"><span>3.4115686416625977 7.78437614440918 0.014417112804949284
</span></span><span style="display:flex;"><span>3.295703649520874 7.845078945159912 0.007442288566380739
</span></span><span style="display:flex;"><span>3.2124576568603516 7.888692378997803 0.0038418297190219164
</span></span><span style="display:flex;"><span>3.152646780014038 7.920027256011963 0.0019832162652164698
</span></span><span style="display:flex;"><span>3.1096746921539307 7.942540168762207 0.0010237823007628322
</span></span><span style="display:flex;"><span>3.078799247741699 7.958716869354248 0.000528489239513874
</span></span></code></pre></td></tr></table>
</div>
</div><p>上述的代码在 pytorch 中对应的有：</p>
<table>
<thead>
<tr>
<th><code>for</code> 循环里面的模型</th>
<th><code>nn.Module</code> 封装好了许多模型</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>loss</code> 的定义</td>
<td>torch 中也有多种计算方式</td>
</tr>
<tr>
<td><code>loss</code> 的计算</td>
<td>优化器 <code>nn.optim</code> 中提供了许多优化器</td>
</tr>
</tbody>
</table>
<p>通过 pytorch 我们可以写成</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#ff79c6">import</span> torch
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">from</span> torch <span style="color:#ff79c6">import</span> nn
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">from</span> torch <span style="color:#ff79c6">import</span> optim
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>x <span style="color:#ff79c6">=</span> torch<span style="color:#ff79c6">.</span>rand([<span style="color:#bd93f9">50</span>,<span style="color:#bd93f9">1</span>])
</span></span><span style="display:flex;"><span>y <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">3</span><span style="color:#ff79c6">*</span>x<span style="color:#ff79c6">+</span><span style="color:#bd93f9">8</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">class</span> <span style="color:#50fa7b">Lr</span>(nn<span style="color:#ff79c6">.</span>Module):
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">def</span> __init__(self):
</span></span><span style="display:flex;"><span>        <span style="color:#8be9fd;font-style:italic">super</span>(Lr, self)<span style="color:#ff79c6">.</span>__init__()
</span></span><span style="display:flex;"><span>        self<span style="color:#ff79c6">.</span>layer <span style="color:#ff79c6">=</span> nn<span style="color:#ff79c6">.</span>Linear(<span style="color:#bd93f9">1</span>,<span style="color:#bd93f9">1</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">def</span> <span style="color:#50fa7b">forward</span>(self, x):
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> self<span style="color:#ff79c6">.</span>layer(x)
</span></span><span style="display:flex;"><span>model <span style="color:#ff79c6">=</span> Lr()
</span></span><span style="display:flex;"><span>criterion <span style="color:#ff79c6">=</span> nn<span style="color:#ff79c6">.</span>MSELoss()
</span></span><span style="display:flex;"><span>optimizer <span style="color:#ff79c6">=</span> optim<span style="color:#ff79c6">.</span>SGD(model<span style="color:#ff79c6">.</span>parameters(), lr<span style="color:#ff79c6">=</span><span style="color:#bd93f9">0.05</span>)
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">for</span> i <span style="color:#ff79c6">in</span> <span style="color:#8be9fd;font-style:italic">range</span>(<span style="color:#bd93f9">500</span>):
</span></span><span style="display:flex;"><span>    out <span style="color:#ff79c6">=</span> model(x)
</span></span><span style="display:flex;"><span>    loss <span style="color:#ff79c6">=</span> criterion(y, out)
</span></span><span style="display:flex;"><span>    optimizer<span style="color:#ff79c6">.</span>zero_grad()
</span></span><span style="display:flex;"><span>    loss<span style="color:#ff79c6">.</span>backward()
</span></span><span style="display:flex;"><span>    optimizer<span style="color:#ff79c6">.</span>step()
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">list</span>(model<span style="color:#ff79c6">.</span>parameters())
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
<!--list-separator-->
<ul>
<li>
<p>激活函数</p>
<figure><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/4/4a/Action_potential.svg/718px-Action_potential.svg.png"/>
</figure>

<p>神经网络本意是想模仿神经元。高中我们学过神经受到刺激后不一定会产生电信号，而是需要达到阈值后才能产生动作电位。因此当神经网络的输入层收到信号传导给隐藏层后，隐藏层是直接向输出层传导（这样的话通过神经网络线性函数的叠加仍然是一个线性函数），而是要经历一个非线性的“激活函数”，如 <code>relu</code> , <code>sigmoid</code>, <code>softsign</code> ，然后再进行传导。即针对 \(X\) 输入，神经元输出会是 \(f(W^TX+b)\) 。</p>
<p>我们可以在这里可视化地理解一下
<a href="https://playground.tensorflow.org/">https://playground.tensorflow.org/</a></p>
</li>
</ul>
<!--list-separator-->
<ul>
<li>
<p>一个尝试</p>
<p>这是我用两层神经网络的代码</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#ff79c6">from</span> torch <span style="color:#ff79c6">import</span> nn
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">import</span> torch
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Ytrain_nn <span style="color:#ff79c6">=</span> pd<span style="color:#ff79c6">.</span>get_dummies(Ytrain)
</span></span><span style="display:flex;"><span>encode <span style="color:#ff79c6">=</span> Ytrain_nn<span style="color:#ff79c6">.</span>columns
</span></span><span style="display:flex;"><span>Ytrain_nn <span style="color:#ff79c6">=</span> torch<span style="color:#ff79c6">.</span>tensor(Ytrain_nn<span style="color:#ff79c6">.</span>values, dtype<span style="color:#ff79c6">=</span>torch<span style="color:#ff79c6">.</span>float32)
</span></span><span style="display:flex;"><span>Xtrain_nn <span style="color:#ff79c6">=</span> torch<span style="color:#ff79c6">.</span>tensor(Xtrain<span style="color:#ff79c6">.</span>values, dtype<span style="color:#ff79c6">=</span>torch<span style="color:#ff79c6">.</span>float32)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>hidden_layer <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">40</span>
</span></span><span style="display:flex;"><span>net <span style="color:#ff79c6">=</span> nn<span style="color:#ff79c6">.</span>Sequential(
</span></span><span style="display:flex;"><span>    nn<span style="color:#ff79c6">.</span>Linear(Xtrain_nn<span style="color:#ff79c6">.</span>shape[<span style="color:#bd93f9">1</span>], hidden_layer),
</span></span><span style="display:flex;"><span>    nn<span style="color:#ff79c6">.</span>ReLU(),
</span></span><span style="display:flex;"><span>    nn<span style="color:#ff79c6">.</span>Linear(hidden_layer, <span style="color:#8be9fd;font-style:italic">len</span>(encode)),
</span></span><span style="display:flex;"><span>    nn<span style="color:#ff79c6">.</span>Softmax(dim<span style="color:#ff79c6">=</span><span style="color:#bd93f9">1</span>),
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>optimizer <span style="color:#ff79c6">=</span> torch<span style="color:#ff79c6">.</span>optim<span style="color:#ff79c6">.</span>SGD(net<span style="color:#ff79c6">.</span>parameters(), lr<span style="color:#ff79c6">=</span><span style="color:#bd93f9">0.001</span>)
</span></span><span style="display:flex;"><span>loss_func <span style="color:#ff79c6">=</span> torch<span style="color:#ff79c6">.</span>nn<span style="color:#ff79c6">.</span>MSELoss()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">for</span> t <span style="color:#ff79c6">in</span> <span style="color:#8be9fd;font-style:italic">range</span>(<span style="color:#bd93f9">10000</span>):
</span></span><span style="display:flex;"><span>    prediction <span style="color:#ff79c6">=</span> net(Xtrain_nn)
</span></span><span style="display:flex;"><span>    loss <span style="color:#ff79c6">=</span> loss_func(Ytrain_nn, prediction)
</span></span><span style="display:flex;"><span>    optimizer<span style="color:#ff79c6">.</span>zero_grad()
</span></span><span style="display:flex;"><span>    loss<span style="color:#ff79c6">.</span>backward()
</span></span><span style="display:flex;"><span>    optimizer<span style="color:#ff79c6">.</span>step()
</span></span><span style="display:flex;"><span>Xtest_nn <span style="color:#ff79c6">=</span> torch<span style="color:#ff79c6">.</span>tensor(Xtest<span style="color:#ff79c6">.</span>values, dtype<span style="color:#ff79c6">=</span>torch<span style="color:#ff79c6">.</span>float32)
</span></span><span style="display:flex;"><span>prediction <span style="color:#ff79c6">=</span> pd<span style="color:#ff79c6">.</span>DataFrame(net(Xtest_nn)<span style="color:#ff79c6">.</span>detach()<span style="color:#ff79c6">.</span>numpy())
</span></span><span style="display:flex;"><span>Ypredict <span style="color:#ff79c6">=</span> prediction<span style="color:#ff79c6">.</span>idxmax(axis<span style="color:#ff79c6">=</span><span style="color:#bd93f9">1</span>)<span style="color:#ff79c6">.</span>map(<span style="color:#ff79c6">lambda</span> x: encode[x])
</span></span><span style="display:flex;"><span>result[<span style="color:#f1fa8c">&#34;bp neural network&#34;</span>] <span style="color:#ff79c6">=</span> get_score(Xtest, Ytest, <span style="color:#ff79c6">lambda</span> _: Ypredict)
</span></span><span style="display:flex;"><span>result[<span style="color:#f1fa8c">&#34;bp neural network&#34;</span>]
</span></span></code></pre></td></tr></table>
</div>
</div><table>
<thead>
<tr>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>precision</td>
<td>:</td>
<td>0.26544421064885426</td>
<td>recall</td>
<td>:</td>
<td>0.30295566502463056</td>
<td>f1</td>
<td>:</td>
<td>0.26043873084791463</td>
<td>\(R^2\)</td>
<td>:</td>
<td>-0.05086786181032697</td>
</tr>
</tbody>
</table>
</li>
</ul>
<h4 id="cnn">CNN</h4>
<p>所谓卷积神经网络，就是用卷积核扫描，类似“锐化”，是一种比较经典的计算机视觉算法。图片之间的像素是有关系的，刚刚的神经网络显然没有考虑到连续像素的关联性，CNN 通过做卷积将关系呈现出来。
<img src="https://pic2.zhimg.com/v2-ede517995e1604d6f96cc01614d320b9_b.jpg" alt=""></p>
<p>卷积神经网络先用卷积层扫描出特征，然后利用“池化”增强稳健性防止过拟合，最后一个全连接层处理输出。图像可以由二维的位置和第三维（颜色 RGB ）确定，在 <code>pytorch</code> 中常用 <code>Conv2d</code> 。而我们的数据则是一条条的，望文生义应该用 <code>Conv1d</code> （其实会用在自然语言处理中，但 RNN 应用更多）。</p>
<p>从这里开始利用 CPU 训练比较慢，有 NVIDIA GPU 的同学可以尝试在 GPU 上训练</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#ff79c6">class</span> <span style="color:#50fa7b">CNN</span>(nn<span style="color:#ff79c6">.</span>Module):
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">def</span> __init__(self) <span style="color:#ff79c6">-&gt;</span> <span style="color:#ff79c6">None</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#8be9fd;font-style:italic">super</span>(CNN, self)<span style="color:#ff79c6">.</span>__init__()
</span></span><span style="display:flex;"><span>        self<span style="color:#ff79c6">.</span>conv <span style="color:#ff79c6">=</span> nn<span style="color:#ff79c6">.</span>Sequential(
</span></span><span style="display:flex;"><span>            nn<span style="color:#ff79c6">.</span>Conv1d(Xtrain_nn<span style="color:#ff79c6">.</span>shape[<span style="color:#bd93f9">1</span>], <span style="color:#bd93f9">20</span>, <span style="color:#bd93f9">3</span>, padding<span style="color:#ff79c6">=</span><span style="color:#bd93f9">3</span>),
</span></span><span style="display:flex;"><span>            nn<span style="color:#ff79c6">.</span>Tanh(),
</span></span><span style="display:flex;"><span>            nn<span style="color:#ff79c6">.</span>AvgPool1d(<span style="color:#bd93f9">2</span>),
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>        self<span style="color:#ff79c6">.</span>fc <span style="color:#ff79c6">=</span> nn<span style="color:#ff79c6">.</span>Sequential(
</span></span><span style="display:flex;"><span>            nn<span style="color:#ff79c6">.</span>Linear(<span style="color:#bd93f9">40</span>, <span style="color:#8be9fd;font-style:italic">len</span>(encode)),
</span></span><span style="display:flex;"><span>            nn<span style="color:#ff79c6">.</span>ReLU(),
</span></span><span style="display:flex;"><span>            nn<span style="color:#ff79c6">.</span>Softmax(dim<span style="color:#ff79c6">=</span><span style="color:#bd93f9">1</span>),
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">def</span> <span style="color:#50fa7b">forward</span>(self, x):
</span></span><span style="display:flex;"><span>        out <span style="color:#ff79c6">=</span> self<span style="color:#ff79c6">.</span>conv(x)
</span></span><span style="display:flex;"><span>        out <span style="color:#ff79c6">=</span> out<span style="color:#ff79c6">.</span>view(out<span style="color:#ff79c6">.</span>size(<span style="color:#bd93f9">0</span>), <span style="color:#ff79c6">-</span><span style="color:#bd93f9">1</span>)
</span></span><span style="display:flex;"><span>        out <span style="color:#ff79c6">=</span> self<span style="color:#ff79c6">.</span>fc(out)
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> out
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Xtrain_cnn <span style="color:#ff79c6">=</span> Xtrain_nn<span style="color:#ff79c6">.</span>unsqueeze(<span style="color:#bd93f9">2</span>)
</span></span><span style="display:flex;"><span>Xtest_cnn <span style="color:#ff79c6">=</span> Xtest_nn<span style="color:#ff79c6">.</span>unsqueeze(<span style="color:#bd93f9">2</span>)
</span></span><span style="display:flex;"><span>net <span style="color:#ff79c6">=</span> CNN()
</span></span><span style="display:flex;"><span>optimizer <span style="color:#ff79c6">=</span> torch<span style="color:#ff79c6">.</span>optim<span style="color:#ff79c6">.</span>Adamax(net<span style="color:#ff79c6">.</span>parameters())
</span></span><span style="display:flex;"><span>loss_func <span style="color:#ff79c6">=</span> torch<span style="color:#ff79c6">.</span>nn<span style="color:#ff79c6">.</span>L1Loss()
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">for</span> t <span style="color:#ff79c6">in</span> <span style="color:#8be9fd;font-style:italic">range</span>(<span style="color:#bd93f9">10000</span>):
</span></span><span style="display:flex;"><span>    prediction <span style="color:#ff79c6">=</span> net(Xtrain_cnn)
</span></span><span style="display:flex;"><span>    loss <span style="color:#ff79c6">=</span> loss_func(Ytrain_nn, prediction)
</span></span><span style="display:flex;"><span>    optimizer<span style="color:#ff79c6">.</span>zero_grad()
</span></span><span style="display:flex;"><span>    loss<span style="color:#ff79c6">.</span>backward()
</span></span><span style="display:flex;"><span>    optimizer<span style="color:#ff79c6">.</span>step()
</span></span><span style="display:flex;"><span>prediction <span style="color:#ff79c6">=</span> pd<span style="color:#ff79c6">.</span>DataFrame(net(Xtest_cnn)<span style="color:#ff79c6">.</span>detach()<span style="color:#ff79c6">.</span>numpy())
</span></span><span style="display:flex;"><span>Ypredict <span style="color:#ff79c6">=</span> prediction<span style="color:#ff79c6">.</span>idxmax(axis<span style="color:#ff79c6">=</span><span style="color:#bd93f9">1</span>)<span style="color:#ff79c6">.</span>map(<span style="color:#ff79c6">lambda</span> x: encode[x])
</span></span><span style="display:flex;"><span>result[<span style="color:#f1fa8c">&#34;CNN&#34;</span>] <span style="color:#ff79c6">=</span> get_score(Xtest, Ytest, <span style="color:#ff79c6">lambda</span> _: Ypredict)
</span></span><span style="display:flex;"><span>result[<span style="color:#f1fa8c">&#34;CNN&#34;</span>]
</span></span></code></pre></td></tr></table>
</div>
</div><table>
<thead>
<tr>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>precision</td>
<td>:</td>
<td>0.4082557971849646</td>
<td>recall</td>
<td>:</td>
<td>0.4482758620689655</td>
<td>f1</td>
<td>:</td>
<td>0.41942614177563414</td>
<td>\(R^2\)</td>
<td>:</td>
<td>0.4408076715828733</td>
</tr>
</tbody>
</table>
<h4 id="rnn-and-gan-and-rl">RNN &amp; GAN &amp; RL</h4>
<ul>
<li>循环神经网络：常用在 NLP 中</li>
<li>生成对抗网络：随机取样作为输入，其输出结果需要尽量模仿训练集中的真实样本，使判别网络无法判断生成网络的输出结果是否真实</li>
<li>强化学习：博弈论……</li>
</ul>
<blockquote>
<p>强化学习（RL）是机器学习的一个领域，涉及软件代理如何在环境中采取行动以最大化一些累积奖励的概念。该问题由于其一般性，在许多其他学科中得到研究，如博弈论，控制理论，运筹学，信息论，基于仿真的优化，多智能体系统，群智能，统计和遗传算法。。在运筹学和控制文献中，强化学习被称为近似动态规划或神经动态规划。&ndash;Wikipedia</p>
</blockquote>
<h3 id="对比">对比</h3>
<table>
<thead>
<tr>
<th>precision</th>
<th>recall</th>
<th>f1</th>
<th>\(R^2\)</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>random</td>
<td>0.2305</td>
<td>0.1256</td>
<td>0.1533</td>
<td>0.0097</td>
</tr>
<tr>
<td>logit</td>
<td>0.1968</td>
<td>0.2537</td>
<td>0.1616</td>
<td>-0.0162</td>
</tr>
<tr>
<td>decision tree</td>
<td>0.3678</td>
<td>0.4064</td>
<td>0.3624</td>
<td>0.4867</td>
</tr>
<tr>
<td>random forest</td>
<td>0.3738</td>
<td>0.4089</td>
<td>0.3553</td>
<td>0.3152</td>
</tr>
<tr>
<td>gradient boosting</td>
<td>0.5121</td>
<td>0.5172</td>
<td>0.5022</td>
<td>0.5267</td>
</tr>
<tr>
<td>svm</td>
<td>0.3872</td>
<td>0.3941</td>
<td>0.3311</td>
<td>0.3348</td>
</tr>
<tr>
<td>bp neural network</td>
<td>0.2654</td>
<td>0.303</td>
<td>0.2604</td>
<td>-0.0509</td>
</tr>
<tr>
<td>CNN</td>
<td>0.4083</td>
<td>0.4483</td>
<td>0.4194</td>
<td>0.4408</td>
</tr>
</tbody>
</table>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#ff79c6">import</span> numpy <span style="color:#ff79c6">as</span> np
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>N <span style="color:#ff79c6">=</span> <span style="color:#8be9fd;font-style:italic">len</span>(feature)
</span></span><span style="display:flex;"><span>angles <span style="color:#ff79c6">=</span> np<span style="color:#ff79c6">.</span>linspace(<span style="color:#bd93f9">0</span>, <span style="color:#bd93f9">2</span> <span style="color:#ff79c6">*</span> np<span style="color:#ff79c6">.</span>pi, N, endpoint<span style="color:#ff79c6">=</span><span style="color:#ff79c6">False</span>)
</span></span><span style="display:flex;"><span>angles <span style="color:#ff79c6">=</span> np<span style="color:#ff79c6">.</span>concatenate((angles, [angles[<span style="color:#bd93f9">0</span>]]))
</span></span><span style="display:flex;"><span>fig <span style="color:#ff79c6">=</span> plt<span style="color:#ff79c6">.</span>figure()
</span></span><span style="display:flex;"><span>ax <span style="color:#ff79c6">=</span> fig<span style="color:#ff79c6">.</span>add_subplot(<span style="color:#bd93f9">111</span>, polar<span style="color:#ff79c6">=</span><span style="color:#ff79c6">True</span>)
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">for</span> model <span style="color:#ff79c6">in</span> result:
</span></span><span style="display:flex;"><span>    values <span style="color:#ff79c6">=</span> [i <span style="color:#ff79c6">for</span> i <span style="color:#ff79c6">in</span> result[model]<span style="color:#ff79c6">.</span>values()] <span style="color:#ff79c6">+</span> [result[model][<span style="color:#f1fa8c">&#34;precision&#34;</span>]]
</span></span><span style="display:flex;"><span>    ax<span style="color:#ff79c6">.</span>plot(angles, values, label<span style="color:#ff79c6">=</span>model)
</span></span><span style="display:flex;"><span>    ax<span style="color:#ff79c6">.</span>fill(angles, values, alpha<span style="color:#ff79c6">=</span><span style="color:#bd93f9">0.1</span>)
</span></span><span style="display:flex;"><span>ax<span style="color:#ff79c6">.</span>set_thetagrids(angles[:<span style="color:#ff79c6">-</span><span style="color:#bd93f9">1</span>] <span style="color:#ff79c6">*</span> <span style="color:#bd93f9">180</span> <span style="color:#ff79c6">/</span> np<span style="color:#ff79c6">.</span>pi, feature)
</span></span><span style="display:flex;"><span>ax<span style="color:#ff79c6">.</span>grid(<span style="color:#ff79c6">True</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#ff79c6">.</span>legend(bbox_to_anchor<span style="color:#ff79c6">=</span>(<span style="color:#bd93f9">1.2</span>, <span style="color:#bd93f9">0</span>), ncol<span style="color:#ff79c6">=</span><span style="color:#bd93f9">3</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#ff79c6">.</span>show()
</span></span></code></pre></td></tr></table>
</div>
</div><figure><img src="/ox-hugo/d8ff44da4ea264cd793134bd434b59e01ccde518.png"/>
</figure>

<h2 id="reference">reference</h2>
<style>.csl-entry{text-indent: -1.5em; margin-left: 1.5em;}</style><div class="csl-bib-body">
  <div class="csl-entry"><a id="citeproc_bib_item_1"></a>Golbayani, Parisa, Ionu Florescu, and Rupak Chatterjee. 2020. “A Comparative Study of Forecasting Corporate Credit Ratings Using Neural Networks, Support Vector Machines, and Decision Trees.” <i>The North American Journal of Economics and Finance</i> 54: 101251. <a href="https://www.sciencedirect.com/science/article/pii/S1062940820301480">https://www.sciencedirect.com/science/article/pii/S1062940820301480</a>.</div>
  <div class="csl-entry"><a id="citeproc_bib_item_2"></a>Kellner, Ralf, Maximilian Nagl, and Daniel Rösch. 2022. “Opening the Black Box–Quantile Neural Networks for Loss given Default Prediction.” <i>Journal of Banking &#38; Finance</i> 134: 106334. <a href="https://www.sciencedirect.com/science/article/abs/pii/S0378426621002855">https://www.sciencedirect.com/science/article/abs/pii/S0378426621002855</a>.</div>
  <div class="csl-entry"><a id="citeproc_bib_item_3"></a>Mai, Feng, Shaonan Tian, Chihoon Lee, and Ling Ma. 2019. “Deep Learning Models for Bankruptcy Prediction Using Textual Disclosures.” <i>European Journal of Operational Research</i> 274 (2): 743–58. <a href="https://www.sciencedirect.com/science/article/pii/S0377221718308774">https://www.sciencedirect.com/science/article/pii/S0377221718308774</a>.</div>
  <div class="csl-entry"><a id="citeproc_bib_item_4"></a>Pedregosa, F., G. Varoquaux, A. Gramfort, V. Michel, B. Thirion, O. Grisel, M. Blondel, et al. 2011. “Scikit-Learn: Machine Learning in Python.” <i>Journal of Machine Learning Research</i> 12: 2825–30.</div>
</div>

    </div>
  </article>

  
  






  <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/notes">Notes</a></li>
         
          <li><a href="/posts">Posts</a></li>
         
          <li><a href="/tags">Tags</a></li>
         
          <li><a href="/readme/index.html">About</a></li>
        
      </ul>
    </div>

    
    <div id="toc-footer" style="display: none">
      <nav id="TableOfContents">
  <ul>
    <li><a href="#前言">前言</a></li>
    <li><a href="#机器学习在企业风险管理中的应用">机器学习在企业风险管理中的应用</a></li>
    <li><a href="#机器学习预测信用评级">机器学习预测信用评级</a>
      <ul>
        <li><a href="#数据说明">数据说明</a></li>
        <li><a href="#线性回归与决策树">线性回归与决策树</a></li>
        <li><a href="#集成学习">集成学习</a></li>
        <li><a href="#支持向量机">支持向量机</a></li>
        <li><a href="#k-means">K means</a></li>
        <li><a href="#深度学习-神经网络">深度学习/神经网络</a></li>
        <li><a href="#对比">对比</a></li>
      </ul>
    </li>
    <li><a href="#reference">reference</a></li>
  </ul>
</nav>
    </div>
    

    <div id="share-footer" style="display: none">
      
      <ul>
  
  
    
  
  
  <li>
    <a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fernestdong.github.io%2fposts%2fmachine_learning_in_erm%2f" aria-label="Facebook">
      <i class="fab fa-facebook fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://twitter.com/share?url=https%3a%2f%2fernestdong.github.io%2fposts%2fmachine_learning_in_erm%2f&text=%e6%9c%ba%e5%99%a8%e5%ad%a6%e4%b9%a0%e5%9c%a8%e4%bc%81%e4%b8%9a%e9%a3%8e%e9%99%a9%e7%ae%a1%e7%90%86%e4%b8%ad%e7%9a%84%e5%ba%94%e7%94%a8%e4%b8%be%e4%be%8b" aria-label="Twitter">
      <i class="fab fa-twitter fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fernestdong.github.io%2fposts%2fmachine_learning_in_erm%2f&title=%e6%9c%ba%e5%99%a8%e5%ad%a6%e4%b9%a0%e5%9c%a8%e4%bc%81%e4%b8%9a%e9%a3%8e%e9%99%a9%e7%ae%a1%e7%90%86%e4%b8%ad%e7%9a%84%e5%ba%94%e7%94%a8%e4%b8%be%e4%be%8b" aria-label="Linkedin">
      <i class="fab fa-linkedin fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2fernestdong.github.io%2fposts%2fmachine_learning_in_erm%2f&is_video=false&description=%e6%9c%ba%e5%99%a8%e5%ad%a6%e4%b9%a0%e5%9c%a8%e4%bc%81%e4%b8%9a%e9%a3%8e%e9%99%a9%e7%ae%a1%e7%90%86%e4%b8%ad%e7%9a%84%e5%ba%94%e7%94%a8%e4%b8%be%e4%be%8b" aria-label="Pinterest">
      <i class="fab fa-pinterest fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="mailto:?subject=%e6%9c%ba%e5%99%a8%e5%ad%a6%e4%b9%a0%e5%9c%a8%e4%bc%81%e4%b8%9a%e9%a3%8e%e9%99%a9%e7%ae%a1%e7%90%86%e4%b8%ad%e7%9a%84%e5%ba%94%e7%94%a8%e4%b8%be%e4%be%8b&body=Check out this article: https%3a%2f%2fernestdong.github.io%2fposts%2fmachine_learning_in_erm%2f" aria-label="Email">
      <i class="fas fa-envelope fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2fernestdong.github.io%2fposts%2fmachine_learning_in_erm%2f&title=%e6%9c%ba%e5%99%a8%e5%ad%a6%e4%b9%a0%e5%9c%a8%e4%bc%81%e4%b8%9a%e9%a3%8e%e9%99%a9%e7%ae%a1%e7%90%86%e4%b8%ad%e7%9a%84%e5%ba%94%e7%94%a8%e4%b8%be%e4%be%8b" aria-label="Pocket">
      <i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2fernestdong.github.io%2fposts%2fmachine_learning_in_erm%2f&title=%e6%9c%ba%e5%99%a8%e5%ad%a6%e4%b9%a0%e5%9c%a8%e4%bc%81%e4%b8%9a%e9%a3%8e%e9%99%a9%e7%ae%a1%e7%90%86%e4%b8%ad%e7%9a%84%e5%ba%94%e7%94%a8%e4%b8%be%e4%be%8b" aria-label="reddit">
      <i class="fab fa-reddit fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.tumblr.com/share/link?url=https%3a%2f%2fernestdong.github.io%2fposts%2fmachine_learning_in_erm%2f&name=%e6%9c%ba%e5%99%a8%e5%ad%a6%e4%b9%a0%e5%9c%a8%e4%bc%81%e4%b8%9a%e9%a3%8e%e9%99%a9%e7%ae%a1%e7%90%86%e4%b8%ad%e7%9a%84%e5%ba%94%e7%94%a8%e4%b8%be%e4%be%8b&description=%e5%89%8d%e8%a8%80%20%e4%bb%80%e4%b9%88%e6%98%af%e5%ad%a6%e4%b9%a0%ef%bc%9f%20%e7%bb%b4%e5%9f%ba%e7%99%be%e7%a7%91%e4%b8%8a%e8%af%b4%e5%ad%a6%e4%b9%a0%e6%98%af%e8%8e%b7%e5%be%97%e6%96%b0%e7%9a%84%e7%90%86%e8%a7%a3%e3%80%81%e7%9f%a5%e8%af%86%e3%80%81%e8%a1%8c%e4%b8%ba%e3%80%81%e6%8a%80%e8%83%bd%e3%80%81%e4%bb%b7%e5%80%bc%e8%a7%82%e3%80%81%e6%80%81%e5%ba%a6%e5%92%8c%e5%81%8f%e5%a5%bd%e7%9a%84%e8%bf%87%e7%a8%8b%e3%80%82%e5%9c%a8%e8%ae%a1%e7%ae%97%e6%8a%80%e6%9c%af%e5%bf%ab%e9%80%9f%e5%8f%91%e5%b1%95%e7%9a%84%e4%bb%8a%e5%a4%a9%ef%bc%8c%e6%9f%93%e6%9c%ba%e5%99%a8%e5%8e%bb%e5%88%a9%e7%94%a8%e7%ae%97%e6%b3%95%e5%92%8c%e7%ae%97%e5%8a%9b" aria-label="Tumblr">
      <i class="fab fa-tumblr fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fernestdong.github.io%2fposts%2fmachine_learning_in_erm%2f&t=%e6%9c%ba%e5%99%a8%e5%ad%a6%e4%b9%a0%e5%9c%a8%e4%bc%81%e4%b8%9a%e9%a3%8e%e9%99%a9%e7%ae%a1%e7%90%86%e4%b8%ad%e7%9a%84%e5%ba%94%e7%94%a8%e4%b8%be%e4%be%8b" aria-label="Hacker News">
      <i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i>
    </a>
  </li>
</ul>

    </div>

    <div id="actions-footer">
      
        <a id="menu-toggle" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;" aria-label="Menu">
          <i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        
        <a id="toc-toggle" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;" aria-label="TOC">
          <i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        
        <a id="share-toggle" class="icon" href="#" onclick="$('#share-footer').toggle();return false;" aria-label="Share">
          <i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" aria-label="Top of Page">
          <i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>


  <footer id="footer">
  <div class="footer-left">
    Copyright  &copy; 2022  Ernest Dong 
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
        <li><a href="/">Home</a></li>
         
        <li><a href="/notes">Notes</a></li>
         
        <li><a href="/posts">Posts</a></li>
         
        <li><a href="/tags">Tags</a></li>
         
        <li><a href="/readme/index.html">About</a></li>
        
      </ul>
    </nav>
  </div>
</footer>


  </div>
</body>

<link rel="stylesheet" href=/lib/font-awesome/css/all.min.css>
<script src=/lib/jquery/jquery.min.js></script>
<script src=/js/main.js></script>

<script src=/js/code-copy.js></script>



  


<script>
  MathJax = {
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']]
    },
    svg: {
      fontCache: 'global'
    }
  };
</script>
<script type="text/javascript" id="MathJax-script" async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
</script>

</html>
